#!/bin/bash
set -o errexit -o nounset -o pipefail

# preflight checks
docker version >/dev/null 2>&1 || { echo >&2 "docker should be installed and running. Aborting."; exit 1; }

# extract payload and load into docker if not extracted
if [ ! -f "${GENCONF_TAR}" ]
then
  echo Extracting docker container from this script
  sed '0,/^#EOF#$/d' $0 | tar xv
  echo Loading container into Docker daemon
  docker load -i ${GENCONF_TAR}
fi

echo "Running mesosphere/dcos-genconf docker with BUILD_DIR set to $PWD/genconf"
mkdir -p genconf
docker run -it -v $(pwd)/genconf/:/genconf mesosphere/dcos-genconf:with-bootstrap-${DOCKER_TAG} "$@"

exit 0
#EOF#
