#!/bin/bash
set -o errexit -o nounset -o pipefail

PRG=$0
usage()
{{
    echo "Usage: $PRG [options] [CMD...]"
    echo "Any arguments provided will be interpretted as commands for the installer docker container"
    echo "Options:"
    echo "--help      Print this statement"
    echo "--version   Print git SHA's for repos used"
    exit 0
}}

version()
{{
    echo "dcos-installer revision: {DCOS_INSTALLER_COMMIT}"
    echo "dcos-image revision: {DCOS_IMAGE_COMMIT}"
    exit 0
}}

first_arg="$1"
case "$first_arg" in
    --help) usage ;;
    --version) version ;;
esac


# preflight checks
docker version >/dev/null 2>&1 || {{ echo >&2 "docker should be installed and running. Aborting."; exit 1; }}

# extract payload and load into docker if not extracted
if [ ! -f "{installer_tar}" ]
then
  echo Extracting docker container from this script
  sed '0,/^#EOF#$/d' $0 | tar xv
  echo Loading container into Docker daemon
  docker load -i {installer_tar}
fi

if [ ! -d installer_data ]; then
    mkdir installer_data
fi

if [ -z "$@" ]; then
docker run -i -v $(pwd)/installer_data/:/installer_data {docker_image_name} dcos-installer --web
else
docker run -i -v $(pwd)/installer_data/:/installer_data {docker_image_name} "$@"
fi

exit 0
